---
layout: post
title: "比特币技术原理与发展现状"
description: "介绍比特币底层技术原理，并了解其本身和相关技术的发展现状"
date: 2025-03-05T14:25:18+08:00
image: "/posts/blockchain/bitcoin/images/chapter_1-cover.jpg"
tags: ["Blockchain"]
---

## 货币体系依赖于信任

当我们在使用现金交易时，通常一手交钱一手交货，货币由国家发放，有国家信用背书，因此大家都承认了货币的价值，并且有多种防伪机制来检查货币的真伪，也保障了交易的安全。由此可见对货币价值的认可和货币在交易中的安全性，是货币能够用于交易的基本要素。

可是，当交易发生在数字世界时，情况发生了变化。例如当我们进行网购时，交易并不是只有买卖双方参与，而是需要由银行对交易进行处理，从买方的账户数据中扣除资金，在卖方的账户数据中增加资金。

<div class="content-image">
<img src="/posts/blockchain/bitcoin/images/chapter_1-cash-vs-electronic-cash.jpg" width="80%">
<p>Cash vs Electronic Cash</p>
</div>

为什么在线上交易无法像线下一样，买方将资金直接给到卖方呢？你也许会说因为货币的形式不同了，没错，货币的存在形式发生变化，由物理的存在变为了数字的存在。物理货币由国家发放且有有效的防伪机制来保障货币安全，因此个人无法凭空创造出现金，双方基于这种共识和信任来完成交易。而数字货币只是一段数据，不像物理货币一样拥有有效的防伪手段，如果每个人都像管理现金一样，管理自己的数字账户，也就意味着可以随意修改账户数据来“发行”数字货币，伪造自己的账户余额，那么公民对于数字货币系统的信任就崩塌了，也就无法实现交易，所以需要一个可信的第三方机构，大家将账户都交由它管理，当需要交易时，由该机构来处理交易，双方基于对第三方机构的信任来完成线上交易。

## 比特币：原生的可信数字货币

2008年，中本聪发布比特币白皮书《比特币：点对点的电子现金系统》，其目标是设计出一种不需要依赖第三方可信机构来处理交易的数字货币系统，其实际目的就是要设计出一种能够像使用现金一样，交易双方直接进行交易的数字货币。

我们已经讨论过在交易中，对货币价值的认可和货币在交易中的安全性，是货币能够用于交易的基本要素。比特币与传统的物理货币和数字货币不同，传统的物理货币通常由国家发行，数字货币则由物理货币，经可信机构等额兑换而来，而比特币是由比特币系统自己发行的，因此，为了让比特币发挥其货币属性，无论要认可其价值，还是要认可其在交易中的安全性，本质上都是要人们对比特币系统本身的价值和安全性达成信任。

目前，比特币的价值依旧与法币挂钩，其货币属性远低于资产属性。从经济角度来看，比特币的高波动性吸引了大量投机者，其价格容易被市场情绪、机构动向或宏观经济事件推动，而非长期价值逻辑；从政治角度来看，许多国家和地区对比特币的定性尚不明确，导致其价值波动受政策预期影响，部分国家限制比特币与法币的交易。由此可见，对比特币的价值认同，需超越投机，建立基于实用性和抗通胀特性的长期共识。

比特币的安全性源于区块链技术，这是构建比特币货币价值的重中之重。现在让我们一探区块链技术的究竟，看看它是如何在比特币系统本身发行货币的情况下，移除对可信第三方的依赖，来保证比特币在交易中的安全性的。

## 区块链

<div class="content-image">
<img src="/posts/blockchain/bitcoin/images/chapter_1-blockchain.jpg" width="50%">
<p>Blockchain</p>
</div>

我们将实现比特币系统的底层技术称为区块链技术，这是因为在比特币系统中，交易数据被打包成一种被称为区块的数据结构，并以链表的形式组织。

### 交易如何实现？

在传统的数字货币系统中，交易双方的账户由可信第三方机构统一管理，但在没有中心化组织的情况下，我们如何构建和管理自己的账户呢？比特币通过非对称加密技术和 UTXO 模型实现账户管理。

#### 公钥与私钥

每一个账户拥有一对公钥和私钥。私钥是用户对比特币的唯一控制权证明，所有交易必须使用私钥进行数字签名才能生效，且私钥一旦丢失，账户资金将永久无法找回。公钥则用于验证交易合法性，确保交易发起者身份真实。

#### UTXO 交易模型

比特币系统中的交易分为输入和输出。系统维护了一个 UTXO 池，每个 UTXO 表示一笔未被使用的交易输出，输入消耗现有 UTXO 作为交易资金来源，输出则定义资金的新去向，每个账户的比特币余额就是 UTXO 池中与该账户关联的 UTXO 之和。例如，在下图中，账户A向账户B发起了一笔0.6 BTC 的转账，此时 UTXO 池中有两个 UTXO 与账户A关联，由于没有单个 UTXO 足够支付，于是使用了这两个 UTXO ，共0.7 BTC ，在转账时将找零的0.1 BTC 转回账户A。

<div class="content-image">
<img src="/posts/blockchain/bitcoin/images/chapter_1-transaction-process.jpg" width="50%">
<p>Transaction Process</p>
</div>

### 如何对交易达成共识？

在密克罗尼西亚的雅浦岛上，石雕被用作货币，其中最大的一块直径达到了3.6米，当它的所有权发生变更时，人们不会移动它，但社区里的每个人都直到它有了新主人。

与之相似，比特币在交易时只发生所有权的变更。传统的数字货币交易，由中心化的可信第三方机构处理，因为大家都相信该机构，所以都承认交易的有效性。但在比特币系统中，不存在这样的第三方机构，交易是否合法、有效，需要整个比特币系统中的所有节点达成共识。

#### 交易广播

当一笔交易被签发时，会在比特币系统网络中被广播。比特币网络是一种采用Gossip协议的点对点网络，当交易被广播时，会像八卦一样在网络中四散开来，收到交易的节点会验证交易有效性，如果交易有效，会继续广播，无效则不会继续广播，而矿工节点在确认交易有效后，还会将其存入交易池中，等待被打包进区块。

<div class="content-image">
<img src="/posts/blockchain/bitcoin/images/chapter_1-broadcast-transaction.jpg" width="50%">
<p>Broadcast Transaction</p>
</div>

#### PoW 挖矿

矿工节点打包区块的过程称为“挖矿”，这一名称源于其资源消耗性和竞争性特征，类似于传统矿产开采需要投入物理劳动或资本以获取稀缺资源。

矿工需要通过计算找到一个符合网络难度要求的区块哈希值（Nonce），这需要投入大量计算资源和电力进行哈希运算，类似于挖矿需要能源投入。系统所有矿工同时竞争求解哈希难题，胜出者才能获得区块奖励，这种通过消耗资源来获得奖励的机制称为工作量证明机制（PoW）。比特币总量上限为2100万枚，挖矿奖励每210000个区块减半（约四年一次），模拟“矿产”有限性。当所有比特币被“开采”之后，矿工的挖矿奖励将完全来自于交易手续费。

当一个区块被打包后，与交易一样会在系统中广播，接收到区块的节点会验证区块的有效性，如果有效则将该区块加入到本地的区块链中，并继续广播，无效则停止广播，如果节点是矿工节点，还会检查区块中是否已包含了自己正在打包的交易，如果存在会丢弃自己正在打包的区块，从交易池中重新选择交易开始打包。

<div class="content-image">
<img src="/posts/blockchain/bitcoin/images/chapter_1-broadcast-block.jpg" width="80%">
<p>Broadcast Block</p>
</div>

#### 区块与链式结构

区块的数据结构可分为两部分，区块头和区块体。区块头包括前一个区块的哈希、难度目标、时间戳、版本号、梅克尔根、随机数；区块体中包含一组交易。

<div class="content-image">
<img src="/posts/blockchain/bitcoin/images/chapter_1-the-structure-of-block.jpg" width="100%">
<p>The Structure of Block</p>
</div>

* Previous Hash：指向区块链中前一区块的哈希值，形成链式结构，确保区块只能追加到链的末端，防止篡改历史记录。
* Difficulty Target：难度目标，矿工需通过计算找到一个Nonce，使得区块头的哈希值小于该目标值，系统会根据全网算力自动调整难度，确保平均10分钟产出一个区块。
* Timestamp：记录区块创建的Unix时间戳，精确到秒。
* Version：标识区块使用的协议版本。
* Merkle Root：梅克尔根哈希，所有交易哈希值的二次哈希，通过梅克尔树生成，代表该区块所有交易的指纹。
* Nonce：矿工通过暴力搜索Nonce值，使得 Block Hash < Difficulty Target。

这样的链式结构保障了区块数据的不可篡改性，若要篡改某一条交易，就必须重新构建该记录所在区块和后续所有的区块，而每个区块的生成都需要算力，并且还需要得到网络中大部分节点的认可，因此，如果要篡改数据，就需要拥有超过全系统50%的算力，这几乎是不可能的。

#### 链分叉和双重支付

请考虑这样一种情况，当系统中有两个或多个矿工节点几乎同时打包好区块，并在系统中广播。由于这两个区块都合法，因此区块链出现了分叉，但随着后续区块的创建，某一条分叉会变为较长的链，此时，其余分叉将被淘汰，这一特性称为最长有效链原则。

##### 示例
* 矿工 A 的区块先被部分节点接受，矿工 B 的区块被另一部分节点接受。
* 矿工 C 在矿工 A 的链上生成新区块时，该链长度变为 n+1，而矿工 B 的链仍为 n。
* 全网节点自动切换到矿工 A 的链，矿工 B 的区块被丢弃。

<div class="content-image">
<img src="/posts/blockchain/bitcoin/images/chapter_1-the-longest-valid-chain.jpg" width="80%">
<p>The Longest Valid Chain</p>
</div>

利用最长有效链原则可以规避双重支付问题。当某个账户在短时间内进行多笔交易，由于网络延时，导致某些 UTXO 可能同时会被作为多笔交易的输入，并在全网广播，由于网络延时，这些交易到达不同节点的顺序不同，因此不同节点认为的有效交易也不同，这使得打包出来的区块包含的交易也是不一样的，这时区块链出现了分叉，但随着后续区块的加入，一定会有每一条链成为最长链，这时其他版本链将失效。

## 总结

* 对货币价值的认可和货币在交易中的安全性，是货币能够用于交易的基本要素。传统数字货币系统依赖第三方可信机构的中心化管理来实现这两点，但比特币通过区块链技术实现了去中心化的数字货币系统。

* 比特币系统采用非对称加密技术和 UTXO 交易模型实现了不依赖第三方机构的数字货币交易，配合点对点网络、PoW 机制、区块、链式锁定、和最长有效链原则，解决了双重支付问题，保证了链上数据不可篡改。